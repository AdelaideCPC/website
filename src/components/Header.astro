---
import { JOIN_LINK } from "@/data/links";

interface Props {
  noBorder?: boolean;
}

const { noBorder = false } = Astro.props;

type Links = {
  text: string;
  href: string;
};

const LINKS: Links[] = [
  { text: "AUCPL", href: "https://aucpl.com" },
  { text: "About", href: "/about" },
  { text: "Events", href: "/events" },
  { text: "Resources", href: "/resources" },
  { text: "Sponsors", href: "/sponsors" },
  { text: "Join", href: JOIN_LINK },
];
---

<header id="header" class="text-xl">
  <div class=`hidden xl:block ${noBorder ? "" : "border-b"} z-50`>
    <div class="mx-auto max-w-7xl flex grow py-4">
      <a href="/">
        <img
          src="/acpc-logo-short.svg"
          alt="ACPC Logo"
          class="h-12 mr-4 inline-block"
        />
      </a>
      <nav class="flex grow pl-6 place-content-end items-center">
        <ul class="flex gap-6" id="desktop-nav">
          {
            LINKS.map((link) => (
              <li>
                <a class="nav-link" href={link.href}>
                  {link.text}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
  </div>

  {/* Mobile */}
  <div id="mobile-header" class="z-50 w-full px-8">
    {/* Mobile header */}
    <div class="flex xl:hidden py-4 w-full">
      <div class="flex flex-1 place-content-between">
        <a href="/">
          <img
            src="/acpc-logo-short.svg"
            alt="ACPC Logo"
            class="h-10 mr-4 inline-block"
          />
        </a>
        <button
          id="hamburger-menu"
          aria-label="Toggle navigation"
          aria-expanded="false"
          class="grid place-content-center h-fit self-center"
        >
          <div class="header-bar bg-white w-[30px] h-0.5 my-1"></div>
          <div class="header-bar bg-white w-[30px] h-0.5 my-1"></div>
          <div class="header-bar bg-white w-[30px] h-0.5 my-1"></div>
        </button>
      </div>
    </div>
    {/* Mobile menu */}
    <div
      id="nav-menu"
      style="display:none;"
      class="flex flex-col h-screen overflow-y-scroll"
    >
      <nav class="pt-8">
        <ul class="flex flex-col gap-6 mb-auto">
          {
            LINKS.map((link) => (
              <li>
                <a href={link.href}>{link.text}</a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
  </div>
</header>

<style>
  /* Navigation link underline animation */
  .nav-link {
    position: relative;
    display: inline-block;
    transition: color 0.3s ease;
  }

  .nav-link::after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: currentColor;
    transform: scaleX(0);
    transition: transform 0.2s ease;
  }

  .nav-link:hover {
    color: rgb(var(--color-primary));
  }

  .nav-link:hover::after {
    transform: scaleX(1);
  }

  /* Animation from left */
  .nav-link.from-left::after {
    transform-origin: left;
  }

  /* Animation from right */
  .nav-link.from-right::after {
    transform-origin: right;
  }

  /* Animation from center (default/bottom hover) */
  .nav-link.from-center::after,
  .nav-link::after {
    transform-origin: center;
  }

  /* Mobile hamburger menu styles */
  .open .header-bar:nth-of-type(1) {
    transform: rotate(-45deg) translate(-2px, -3px);
    transform-origin: bottom right;
  }

  .open .header-bar:nth-of-type(2) {
    opacity: 0;
    transform: scale(0);
  }

  .open .header-bar:nth-of-type(3) {
    transform: rotate(45deg) translate(-2px, 3px);
    transform-origin: top right;
  }
</style>

<script is:inline>
  // Desktop navigation directional underline animation
  (() => {
    const desktopNav = document.getElementById("desktop-nav");
    if (!desktopNav) return;

    const navLinks = Array.from(desktopNav.querySelectorAll(".nav-link"));
    let lastHoveredIndex = -1;

    navLinks.forEach((link, index) => {
      link.addEventListener("mouseenter", (e) => {
        // Remove previous direction classes
        link.classList.remove("from-left", "from-right", "from-center");

        if (lastHoveredIndex === -1) {
          // Direct hover or from bottom - animate from center
          link.classList.add("from-center");
        } else if (index > lastHoveredIndex) {
          // Moving left to right - animate from left
          link.classList.add("from-left");
        } else if (index < lastHoveredIndex) {
          // Moving right to left - animate from right
          link.classList.add("from-right");
        } else {
          // Same link - animate from center
          link.classList.add("from-center");
        }

        lastHoveredIndex = index;
      });
    });

    // Reset when mouse leaves the nav entirely
    if (desktopNav.parentElement) {
      desktopNav.parentElement.addEventListener("mouseleave", () => {
        lastHoveredIndex = -1;
      });
    }
  })();

  // Mobile menu toggle
  let menuOpen = false;
  const mobileHeader = document.getElementById("mobile-header");
  const menuButton = document.getElementById("hamburger-menu");
  const menu = document.getElementById("nav-menu");
  const header = document.getElementById("header");
  const root = document.getElementById("root");

  menuButton.addEventListener("click", () => {
    if (menuOpen) {
      mobileHeader.classList.remove("bg-base");
      header.classList.remove("open");
      menu.style.display = "none";
      root.style.overflowY = "visible";
      menuButton.setAttribute("aria-expanded", "false");
      menuOpen = false;
    } else {
      mobileHeader.classList.add("bg-base");
      header.classList.add("open");
      menu.style.display = "block";
      root.style.overflowY = "hidden";
      menuButton.setAttribute("aria-expanded", "true");
      menuOpen = true;
    }
  });
</script>
